<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - School Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3a86ff;
            --secondary-color: #2667cc;
            --accent-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4bb543;
            --warning-color: #ffcc00;
            --danger-color: #f44336;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            transition: all 0.3s;
            box-shadow: var(--box-shadow);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            margin-left: 10px;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu ul {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 3px solid var(--accent-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .user-info h4 {
            margin-bottom: 2px;
            font-size: 0.9rem;
        }

        .user-info p {
            font-size: 0.8rem;
            color: #666;
        }

        /* Cards Container */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .students {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .classes {
            background-color: rgba(76, 181, 67, 0.1);
            color: var(--success-color);
        }

        .assignments {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }

        .announcements-card {
            background-color: rgba(255, 204, 0, 0.1);
            color: var(--warning-color);
        }

        .card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .card p {
            color: #666;
            font-size: 0.9rem;
        }

        /* Recent Activity Section */
        .recent-activity {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        .section-header a {
            color: var(--accent-color);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary-color);
        }

        .activity-info h4 {
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .activity-info p {
            color: #666;
            font-size: 0.85rem;
        }

        .activity-time {
            margin-left: auto;
            color: #999;
            font-size: 0.8rem;
        }

        /* Classes Section */
        .classes-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .class-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .class-item:last-child {
            border-bottom: none;
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .class-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .class-time {
            color: #999;
            font-size: 0.8rem;
        }

        .class-content {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Assignments Section */
        .assignments-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .assignment-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .assignment-item:last-child {
            border-bottom: none;
        }

        .assignment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .assignment-title {
            font-weight: 600;
            color: var(--primary-color);
        }

        .assignment-due {
            color: #999;
            font-size: 0.8rem;
        }

        .assignment-content {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--secondary-color);
        }

        .btn-add {
            background-color: var(--success-color);
        }

        .btn-add:hover {
            background-color: #3a9a32;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            width: 500px;
            max-width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-cancel {
            background-color: #999;
        }

        .btn-cancel:hover {
            background-color: #777;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .action-btn {
            padding: 5px 10px;
            margin: 0 3px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .view-btn {
            background-color: var(--primary-color);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
                overflow: hidden;
            }

            .sidebar-header h3, .sidebar-menu span {
                display: none;
            }

            .sidebar-menu a {
                justify-content: center;
                padding: 12px 0;
            }

            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.3rem;
            }

            .main-content {
                margin-left: 80px;
            }

            .cards-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 576px) {
            .cards-container {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-profile {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-chalkboard-teacher fa-2x"></i>
            <h3>Teacher Portal</h3>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li><a href="#" class="active" onclick="showDashboard()"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="#" onclick="showClasses()"><i class="fas fa-users"></i> <span>My Classes</span></a></li>
                <li><a href="#" onclick="showAssignments()"><i class="fas fa-tasks"></i> <span>Assignments</span></a></li>
                <li><a href="#" onclick="showStudents()"><i class="fas fa-user-graduate"></i> <span>Students</span></a></li>
                <li><a href="#" onclick="showAnnouncements()"><i class="fas fa-bullhorn"></i> <span>Announcements</span></a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section">
            <!-- Header -->
            <div class="header">
                <h1>Teacher Dashboard</h1>
                <div class="user-profile" onclick="showProfile()">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=3a86ff&color=fff" alt="Teacher User">
                    <div class="user-info">
                        <h4>John Doe</h4>
                        <p>Mathematics Teacher</p>
                    </div>
                </div>
            </div>

            <!-- Cards -->
            <div class="cards-container">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 id="students-count">0</h3>
                            <p>Students</p>
                        </div>
                        <div class="card-icon students">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 id="classes-count">0</h3>
                            <p>Classes</p>
                        </div>
                        <div class="card-icon classes">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 id="assignments-count">0</h3>
                            <p>Assignments</p>
                        </div>
                        <div class="card-icon assignments">
                            <i class="fas fa-tasks"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 id="announcements-count">0</h3>
                            <p>Announcements</p>
                        </div>
                        <div class="card-icon announcements-card">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <div class="section-header">
                    <h2>Recent Activity</h2>
                    <a href="#">View All</a>
                </div>
                <ul class="activity-list" id="activity-list">
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="activity-info">
                            <h4>New Assignment Created</h4>
                            <p>Algebra Homework for Grade 9</p>
                        </div>
                        <div class="activity-time">2 hours ago</div>
                    </li>
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="activity-info">
                            <h4>Assignment Graded</h4>
                            <p>Geometry Quiz for Grade 10</p>
                        </div>
                        <div class="activity-time">1 day ago</div>
                    </li>
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="activity-info">
                            <h4>New Announcement</h4>
                            <p>Parent-Teacher Meeting Scheduled</p>
                        </div>
                        <div class="activity-time">2 days ago</div>
                    </li>
                </ul>
            </div>

            <!-- Upcoming Classes -->
            <div class="classes-section">
                <div class="section-header">
                    <h2>Today's Classes</h2>
                    <a href="#">View All</a>
                </div>
                <div class="class-item">
                    <div class="class-header">
                        <div class="class-title">Grade 9 - Algebra</div>
                        <div class="class-time">9:00 AM - 10:00 AM</div>
                    </div>
                    <div class="class-content">
                        Topic: Quadratic Equations | Room: 201
                    </div>
                </div>
                <div class="class-item">
                    <div class="class-header">
                        <div class="class-title">Grade 10 - Geometry</div>
                        <div class="class-time">11:00 AM - 12:00 PM</div>
                    </div>
                    <div class="class-content">
                        Topic: Trigonometry | Room: 205
                    </div>
                </div>
                <div class="class-item">
                    <div class="class-header">
                        <div class="class-title">Grade 11 - Calculus</div>
                        <div class="class-time">1:00 PM - 2:00 PM</div>
                    </div>
                    <div class="class-content">
                        Topic: Derivatives | Room: 210
                    </div>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="classes-section" style="display: none;">
            <div class="header">
                <h1>My Classes</h1>
                <button class="btn btn-add" onclick="showAddClassModal()">Add Class</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Class Name</th>
                        <th>Grade Level</th>
                        <th>Schedule</th>
                        <th>Room</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="classes-table-body">
                    
                </tbody>
            </table>
        </div>

        <!-- Assignments Section -->
        <div id="assignments-section" style="display: none;">
            <div class="header">
                <h1>Assignments</h1>
                <button class="btn btn-add" onclick="showAddAssignmentModal()">Add Assignment</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Class</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="assignments-table-body">
                    
                </tbody>
            </table>
        </div>

        <!-- Students Section -->
        <div id="students-section" style="display: none;">
            <div class="header">
                <h1>My Students</h1>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Class</th>
                        <th>Grade</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="students-table-body">
                    
                </tbody>
            </table>
        </div>

        <!-- Announcements Section -->
        <div id="announcements-section" style="display: none;">
            <div class="header">
                <h1>Announcements</h1>
                <button class="btn btn-add" onclick="showAddAnnouncementModal()">Add Announcement</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Class</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="announcements-table-body">
                    
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="class-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="class-modal-title">Add New Class</h2>
                <button class="close-btn" onclick="closeModal('class-modal')">&times;</button>
            </div>
            <form id="class-form">
                <input type="hidden" id="class-id">
                <div class="form-group">
                    <label for="class-name">Class Name</label>
                    <input type="text" id="class-name" required>
                </div>
                <div class="form-group">
                    <label for="class-grade">Grade Level</label>
                    <select id="class-grade" required>
                        <option value="">Select Grade</option>
                        <option value="Grade 9">Grade 9</option>
                        <option value="Grade 10">Grade 10</option>
                        <option value="Grade 11">Grade 11</option>
                        <option value="Grade 12">Grade 12</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="class-schedule">Schedule</label>
                    <input type="text" id="class-schedule" placeholder="Mon/Wed 9:00-10:00" required>
                </div>
                <div class="form-group">
                    <label for="class-room">Room Number</label>
                    <input type="text" id="class-room" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('class-modal')">Cancel</button>
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Assignment Modal -->
    <div id="assignment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="assignment-modal-title">Add New Assignment</h2>
                <button class="close-btn" onclick="closeModal('assignment-modal')">&times;</button>
            </div>
            <form id="assignment-form">
                <input type="hidden" id="assignment-id">
                <div class="form-group">
                    <label for="assignment-title">Title</label>
                    <input type="text" id="assignment-title" required>
                </div>
                <div class="form-group">
                    <label for="assignment-class">Class</label>
                    <select id="assignment-class" required>
                        <option value="">Select Class</option>
                        <option value="1">Grade 9 - Algebra</option>
                        <option value="2">Grade 10 - Geometry</option>
                        <option value="3">Grade 11 - Calculus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment-due">Due Date</label>
                    <input type="date" id="assignment-due" required>
                </div>
                <div class="form-group">
                    <label for="assignment-description">Description</label>
                    <textarea id="assignment-description" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('assignment-modal')">Cancel</button>
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Announcement Modal -->
    <div id="announcement-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="announcement-modal-title">Add New Announcement</h2>
                <button class="close-btn" onclick="closeModal('announcement-modal')">&times;</button>
            </div>
            <form id="announcement-form">
                <input type="hidden" id="announcement-id">
                <div class="form-group">
                    <label for="announcement-title">Title</label>
                    <input type="text" id="announcement-title" required>
                </div>
                <div class="form-group">
                    <label for="announcement-class">Class</label>
                    <select id="announcement-class">
                        <option value="0">All Classes</option>
                        <option value="1">Grade 9 - Algebra</option>
                        <option value="2">Grade 10 - Geometry</option>
                        <option value="3">Grade 11 - Calculus</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="announcement-date">Date</label>
                    <input type="date" id="announcement-date" required>
                </div>
                <div class="form-group">
                    <label for="announcement-content">Content</label>
                    <textarea id="announcement-content" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('announcement-modal')">Cancel</button>
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Global variables
    let currentTeacher = {
        id: 1,
        name: "John Doe",
        subject: "Mathematics"
    };
    
    // DOM Content Loaded Event
    document.addEventListener('DOMContentLoaded', function() {
        // Load initial dashboard data
        loadDashboardData();
        
        // Set up form submissions
        setupFormHandlers();
        
        // Set up event listeners for navigation
        setupNavigation();
        
        // Initialize profile display
        showProfile();
    });
    
    // Navigation Functions
    function setupNavigation() {
        // Highlight active menu item on click
        const menuItems = document.querySelectorAll('.sidebar-menu a');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }
    
    function showDashboard() {
        hideAllSections();
        document.getElementById('dashboard-section').style.display = 'block';
        loadDashboardData();
    }
    
    function showClasses() {
        hideAllSections();
        document.getElementById('classes-section').style.display = 'block';
        loadClassesData();
    }
    
    function showAssignments() {
        hideAllSections();
        document.getElementById('assignments-section').style.display = 'block';
        loadAssignmentsData();
    }
    
    function showStudents() {
        hideAllSections();
        document.getElementById('students-section').style.display = 'block';
        loadStudentsData();
    }
    
    function showAnnouncements() {
        hideAllSections();
        document.getElementById('announcements-section').style.display = 'block';
        loadAnnouncementsData();
    }
    
    function hideAllSections() {
        const sections = document.querySelectorAll('.main-content > div');
        sections.forEach(section => {
            section.style.display = 'none';
        });
    }
    
    // Data Loading Functions
    async function loadDashboardData() {
        try {
            // Load counts
            const countsResponse = await fetch(`/api/tdashboard/counts?teacherId=${currentTeacher.id}`);
            const counts = await countsResponse.json();
            
            document.getElementById('students-count').textContent = counts.students || 0;
            document.getElementById('classes-count').textContent = counts.classes || 0;
            document.getElementById('assignments-count').textContent = counts.assignments || 0;
            document.getElementById('announcements-count').textContent = counts.announcements || 0;
            
            // Load recent activities
            const activitiesResponse = await fetch(`/api/tactivities?teacherId=${currentTeacher.id}`);
            const activities = await activitiesResponse.json();
            populateActivities(activities);
            
            // Load today's classes
            const classesResponse = await fetch(`/api/tclasses/today?teacherId=${currentTeacher.id}`);
            const classes = await classesResponse.json();
            populateTodayClasses(classes);
            
        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showError('Failed to load dashboard data');
        }
    }
    
    async function loadClassesData() {
        try {
            const response = await fetch(`/api/tclasses?teacherId=${currentTeacher.id}`);
            const classes = await response.json();
            populateClassesTable(classes);
        } catch (error) {
            console.error('Error loading classes data:', error);
            showError('Failed to load classes data');
        }
    }
    
    async function loadAssignmentsData() {
        try {
            const response = await fetch(`/api/tassignments?teacherId=${currentTeacher.id}`);
            const assignments = await response.json();
            populateAssignmentsTable(assignments);
        } catch (error) {
            console.error('Error loading assignments data:', error);
            showError('Failed to load assignments data');
        }
    }
    
    async function loadStudentsData() {
        try {
            // Get the teacher's classes first
            const classesResponse = await fetch(`/api/tclasses?teacherId=${currentTeacher.id}`);
            const classes = await classesResponse.json();
            
            // Get students for each class
            let allStudents = [];
            for (const cls of classes) {
                const studentsResponse = await fetch(`/api/sclasses/${cls.id}/students`);
                const students = await studentsResponse.json();
                students.forEach(s => {
                    s.class_name = cls.name; // Add class name to each student
                });
                allStudents = [...allStudents, ...students];
            }
            
            populateStudentsTable(allStudents);
        } catch (error) {
            console.error('Error loading students data:', error);
            showError('Failed to load students data');
        }
    }
    
    async function loadAnnouncementsData() {
        try {
            const response = await fetch(`/api/announcements?userId=${currentTeacher.id}&userType=teacher`);
            const announcements = await response.json();
            populateAnnouncementsTable(announcements);
        } catch (error) {
            console.error('Error loading announcements data:', error);
            showError('Failed to load announcements data');
        }
    }
    
    // Data Population Functions
    function populateActivities(activities) {
        const activityList = document.getElementById('activity-list');
        activityList.innerHTML = '';
        
        activities.slice(0, 3).forEach(activity => {
            const activityItem = document.createElement('li');
            activityItem.className = 'activity-item';
            
            activityItem.innerHTML = `
                <div class="activity-icon">
                    <i class="fas ${getActivityIcon(activity.action)}"></i>
                </div>
                <div class="activity-info">
                    <h4>${activity.action}</h4>
                    <p>${activity.details}</p>
                </div>
                <div class="activity-time">${formatTime(activity.created_at)}</div>
            `;
            
            activityList.appendChild(activityItem);
        });
    }
    
    function populateTodayClasses(classes) {
        const todaySchedule = document.querySelector('#dashboard-section .classes-section');
        todaySchedule.innerHTML = `
            <div class="section-header">
                <h2>Today's Classes</h2>
                <a href="#" onclick="showClasses(); return false;">View All</a>
            </div>
        `;
        
        if (classes.length === 0) {
            todaySchedule.innerHTML += '<p>No classes scheduled for today</p>';
            return;
        }
        
        classes.forEach(cls => {
            const classItem = document.createElement('div');
            classItem.className = 'class-item';
            classItem.innerHTML = `
                <div class="class-header">
                    <div class="class-title">${cls.name}</div>
                    <div class="class-time">${cls.schedule}</div>
                </div>
                <div class="class-content">
                    Students: ${cls.student_count || 0} | Room: ${cls.room_number || 'Not specified'}
                </div>
            `;
            todaySchedule.appendChild(classItem);
        });
    }
    
    function populateClassesTable(classes) {
        const tbody = document.getElementById('classes-table-body');
        tbody.innerHTML = '';
        
        classes.forEach(cls => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${cls.id}</td>
                <td>${cls.name}</td>
                <td>${cls.grade_level}</td>
                <td>${cls.schedule || 'Not scheduled'}</td>
                <td>${cls.room_number || 'Not assigned'}</td>
                <td>${cls.student_count || 0}</td>
                <td>
                    <button class="action-btn view-btn" onclick="viewClass(${cls.id})">View</button>
                    <button class="action-btn edit-btn" onclick="editClass(${cls.id})">Edit</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    function populateAssignmentsTable(assignments) {
        const tbody = document.getElementById('assignments-table-body');
        tbody.innerHTML = '';
        
        assignments.forEach(assignment => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${assignment.id}</td>
                <td>${assignment.title}</td>
                <td>${assignment.class_name}</td>
                <td>${new Date(assignment.due_date).toLocaleDateString()}</td>
                <td>${assignment.status}</td>
                <td>${assignment.submissions || 0}/${assignment.graded || 0}</td>
                <td>
                    <button class="action-btn view-btn" onclick="viewAssignment(${assignment.id})">View</button>
                    <button class="action-btn edit-btn" onclick="editAssignment(${assignment.id})">Edit</button>
                    <button class="action-btn delete-btn" onclick="deleteAssignment(${assignment.id})">Delete</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    function populateStudentsTable(students) {
        const tbody = document.getElementById('students-table-body');
        tbody.innerHTML = '';
        
        if (students.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="text-center">No students found in your classes</td></tr>';
            return;
        }
        
        students.forEach(student => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${student.id}</td>
                <td>${student.name}</td>
                <td>${student.class_name}</td>
                <td>${student.grade || 'N/A'}</td>
                <td>${student.email}</td>
                <td>
                    <button class="action-btn view-btn" onclick="viewStudent(${student.id})">View</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    function populateAnnouncementsTable(announcements) {
        const tbody = document.getElementById('announcements-table-body');
        tbody.innerHTML = '';
        
        announcements.forEach(announcement => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${announcement.id}</td>
                <td>${announcement.title}</td>
                <td>${new Date(announcement.created_at).toLocaleDateString()}</td>
                <td>${announcement.class_name || 'All Classes'}</td>
                <td>${announcement.author_name}</td>
                <td>
                    <button class="action-btn view-btn" onclick="viewAnnouncement(${announcement.id})">View</button>
                    ${announcement.author_id === currentTeacher.id ? 
                        `<button class="action-btn edit-btn" onclick="editAnnouncement(${announcement.id})">Edit</button>
                         <button class="action-btn delete-btn" onclick="deleteAnnouncement(${announcement.id})">Delete</button>` 
                        : ''}
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // Form Handlers
    function setupFormHandlers() {
        // Class form
        document.getElementById('class-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = {
                id: document.getElementById('class-id').value || null,
                name: document.getElementById('class-name').value,
                grade_level: document.getElementById('class-grade').value,
                schedule: document.getElementById('class-schedule').value,
                room_number: document.getElementById('class-room').value,
                teacher_id: currentTeacher.id
            };
            
            try {
                const url = formData.id ? '/api/tclasses' : '/api/tclasses';
                const method = formData.id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess(`Class ${formData.id ? 'updated' : 'added'} successfully!`);
                    closeModal('class-modal');
                    loadClassesData();
                    loadDashboardData();
                } else {
                    throw new Error(await response.text());
                }
            } catch (error) {
                console.error('Error saving class:', error);
                showError(`Failed to save class: ${error.message}`);
            }
        });
        
        // Assignment form
        document.getElementById('assignment-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = {
                id: document.getElementById('assignment-id').value || null,
                title: document.getElementById('assignment-title').value,
                class_id: document.getElementById('assignment-class').value,
                due_date: document.getElementById('assignment-due').value,
                description: document.getElementById('assignment-description').value,
                teacher_id: currentTeacher.id
            };
            
            try {
                const url = formData.id ? '/api/tassignments' : '/api/tassignments';
                const method = formData.id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showSuccess(`Assignment ${formData.id ? 'updated' : 'added'} successfully!`);
                    closeModal('assignment-modal');
                    loadAssignmentsData();
                    loadDashboardData();
                } else {
                    throw new Error(await response.text());
                }
            } catch (error) {
                console.error('Error saving assignment:', error);
                showError(`Failed to save assignment: ${error.message}`);
            }
        });
        
        // Announcement form
        document.getElementById('announcement-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const classId = document.getElementById('announcement-class').value;
            const formData = {
                id: document.getElementById('announcement-id').value || null,
                title: document.getElementById('announcement-title').value,
                content: document.getElementById('announcement-content').value,
                target_audience: classId === '0' ? 'all' : 'specific_class',
                class_id: classId === '0' ? null : classId,
                author_id: currentTeacher.id
            };
            
            try {
                const url = formData.id ? '/api/announcements' : '/api/announcements';
                const method = formData.id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showSuccess(`Announcement ${formData.id ? 'updated' : 'added'} successfully!`);
                    closeModal('announcement-modal');
                    loadAnnouncementsData();
                    loadDashboardData();
                } else {
                    throw new Error(await response.text());
                }
            } catch (error) {
                console.error('Error saving announcement:', error);
                showError(`Failed to save announcement: ${error.message}`);
            }
        });
    }
    
    // Modal Functions
    function showAddClassModal() {
        document.getElementById('class-modal-title').textContent = 'Add New Class';
        document.getElementById('class-form').reset();
        document.getElementById('class-id').value = '';
        document.getElementById('class-teacher').value = currentTeacher.name;
        openModal('class-modal');
    }
    
    function showAddAssignmentModal() {
        // Load classes for dropdown
        fetch(`/api/tclasses?teacherId=${currentTeacher.id}`)
            .then(response => response.json())
            .then(classes => {
                const classSelect = document.getElementById('assignment-class');
                classSelect.innerHTML = classes.map(cls => 
                    `<option value="${cls.id}">${cls.name} (${cls.grade_level})</option>`
                ).join('');
                
                document.getElementById('assignment-modal-title').textContent = 'Add New Assignment';
                document.getElementById('assignment-form').reset();
                document.getElementById('assignment-id').value = '';
                document.getElementById('assignment-due').valueAsDate = new Date();
                openModal('assignment-modal');
            })
            .catch(error => {
                console.error('Error loading classes:', error);
                showError('Failed to load classes for assignment');
            });
    }
    
    function showAddAnnouncementModal() {
        // Load classes for dropdown
        fetch(`/api/tclasses?teacherId=${currentTeacher.id}`)
            .then(response => response.json())
            .then(classes => {
                const classSelect = document.getElementById('announcement-class');
                classSelect.innerHTML = `
                    <option value="0">All Classes</option>
                    ${classes.map(cls => 
                        `<option value="${cls.id}">${cls.name}</option>`
                    ).join('')}
                `;
                
                document.getElementById('announcement-modal-title').textContent = 'Add New Announcement';
                document.getElementById('announcement-form').reset();
                document.getElementById('announcement-id').value = '';
                document.getElementById('announcement-date').valueAsDate = new Date();
                openModal('announcement-modal');
            })
            .catch(error => {
                console.error('Error loading classes:', error);
                showError('Failed to load classes for announcement');
            });
    }
    
    function editClass(classId) {
        fetch(`/api/tclasses/${classId}`)
            .then(response => response.json())
            .then(cls => {
                document.getElementById('class-modal-title').textContent = 'Edit Class';
                document.getElementById('class-id').value = cls.id;
                document.getElementById('class-name').value = cls.name;
                document.getElementById('class-grade').value = cls.grade_level;
                document.getElementById('class-schedule').value = cls.schedule;
                document.getElementById('class-room').value = cls.room_number;
                document.getElementById('class-teacher').value = cls.teacher_name || currentTeacher.name;
                openModal('class-modal');
            })
            .catch(error => {
                console.error('Error loading class:', error);
                showError('Failed to load class details');
            });
    }
    
    function editAssignment(assignmentId) {
        fetch(`/api/tassignments/${assignmentId}`)
            .then(response => response.json())
            .then(assignment => {
                document.getElementById('assignment-modal-title').textContent = 'Edit Assignment';
                document.getElementById('assignment-id').value = assignment.id;
                document.getElementById('assignment-title').value = assignment.title;
                document.getElementById('assignment-class').value = assignment.class_id;
                document.getElementById('assignment-due').value = assignment.due_date.split('T')[0];
                document.getElementById('assignment-description').value = assignment.description;
                openModal('assignment-modal');
            })
            .catch(error => {
                console.error('Error loading assignment:', error);
                showError('Failed to load assignment details');
            });
    }
    
    function editAnnouncement(announcementId) {
        fetch(`/api/announcements/${announcementId}`)
            .then(response => response.json())
            .then(announcement => {
                document.getElementById('announcement-modal-title').textContent = 'Edit Announcement';
                document.getElementById('announcement-id').value = announcement.id;
                document.getElementById('announcement-title').value = announcement.title;
                document.getElementById('announcement-class').value = announcement.class_id || 0;
                document.getElementById('announcement-date').value = announcement.created_at.split('T')[0];
                document.getElementById('announcement-content').value = announcement.content;
                openModal('announcement-modal');
            })
            .catch(error => {
                console.error('Error loading announcement:', error);
                showError('Failed to load announcement details');
            });
    }
    
    function viewClass(classId) {
        fetch(`/api/tclasses/${classId}`)
            .then(response => response.json())
            .then(cls => {
                alert(`Viewing Class: ${cls.name}\nGrade: ${cls.grade_level}\nSchedule: ${cls.schedule}\nRoom: ${cls.room_number}\nTeacher: ${cls.teacher_name}\nStudents: ${cls.student_count}`);
            })
            .catch(error => {
                console.error('Error loading class:', error);
                showError('Failed to load class details');
            });
    }
    
    function viewAssignment(assignmentId) {
        fetch(`/api/tassignments/${assignmentId}`)
            .then(response => response.json())
            .then(assignment => {
                alert(`Viewing Assignment: ${assignment.title}\nClass: ${assignment.class_name}\nDue: ${new Date(assignment.due_date).toLocaleDateString()}\nStatus: ${assignment.status}\n\nDescription: ${assignment.description}`);
            })
            .catch(error => {
                console.error('Error loading assignment:', error);
                showError('Failed to load assignment details');
            });
    }
    
    function viewStudent(studentId) {
        fetch(`/api/students/${studentId}`)
            .then(response => response.json())
            .then(student => {
                alert(`Viewing Student:\nName: ${student.name}\nEmail: ${student.email}\nGrade: ${student.grade || 'N/A'}\nParent Contact: ${student.parent_contact || 'N/A'}`);
            })
            .catch(error => {
                console.error('Error loading student:', error);
                showError('Failed to load student details');
            });
    }
    
    function viewAnnouncement(announcementId) {
        fetch(`/api/announcements/${announcementId}`)
            .then(response => response.json())
            .then(announcement => {
                alert(`Viewing Announcement:\nTitle: ${announcement.title}\nDate: ${new Date(announcement.created_at).toLocaleDateString()}\nAuthor: ${announcement.author_name}\nFor: ${announcement.class_name || 'All Classes'}\n\nContent:\n${announcement.content}`);
            })
            .catch(error => {
                console.error('Error loading announcement:', error);
                showError('Failed to load announcement details');
            });
    }
    
    function deleteAssignment(assignmentId) {
        if (confirm('Are you sure you want to delete this assignment?')) {
            fetch(`/api/tassignments/${assignmentId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    showSuccess('Assignment deleted successfully!');
                    loadAssignmentsData();
                    loadDashboardData();
                } else {
                    throw new Error('Failed to delete assignment');
                }
            })
            .catch(error => {
                console.error('Error deleting assignment:', error);
                showError('Failed to delete assignment');
            });
        }
    }
    
    function deleteAnnouncement(announcementId) {
        if (confirm('Are you sure you want to delete this announcement?')) {
            fetch(`/api/announcements/${announcementId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    showSuccess('Announcement deleted successfully!');
                    loadAnnouncementsData();
                    loadDashboardData();
                } else {
                    throw new Error('Failed to delete announcement');
                }
            })
            .catch(error => {
                console.error('Error deleting announcement:', error);
                showError('Failed to delete announcement');
            });
        }
    }
    
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
    }
    
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    // Utility Functions
    function getActivityIcon(action) {
        const icons = {
            'New Assignment': 'fa-tasks',
            'Assignment Graded': 'fa-check-circle',
            'New Announcement': 'fa-bullhorn',
            'Class Updated': 'fa-chalkboard-teacher',
            'default': 'fa-info-circle'
        };
        return icons[action] || icons.default;
    }
    
    function formatTime(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) return 'Today';
        if (diffDays === 1) return 'Yesterday';
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays/7)} weeks ago`;
        return date.toLocaleDateString();
    }
    
    function showError(message) {
        // Create a more user-friendly error display
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.innerHTML = `
            <div class="error-content">
                <span class="close-error" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <strong>Error:</strong> ${message}
            </div>
        `;
        document.body.appendChild(errorDiv);
        
        // Remove after 5 seconds
        setTimeout(() => {
            errorDiv.remove();
        }, 5000);
    }
    
    function showSuccess(message) {
        // Create a more user-friendly success display
        const successDiv = document.createElement('div');
        successDiv.className = 'success-message';
        successDiv.innerHTML = `
            <div class="success-content">
                <span class="close-success" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <strong>Success:</strong> ${message}
            </div>
        `;
        document.body.appendChild(successDiv);
        
        // Remove after 5 seconds
        setTimeout(() => {
            successDiv.remove();
        }, 5000);
    }
    
    // Initialize profile display
    function showProfile() {
        document.querySelector('.user-info h4').textContent = currentTeacher.name;
        document.querySelector('.user-info p').textContent = `${currentTeacher.subject} Teacher`;
    }
    </script>
    
    </body>
    </html>